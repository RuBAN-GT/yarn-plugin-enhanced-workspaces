/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-enhanced-workspaces",
factory: function (require) {
var plugin=(()=>{var _e=Object.create,O=Object.defineProperty;var Ve=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty;var Qe=s=>O(s,"__esModule",{value:!0});var f=s=>{if(typeof require!="undefined")return require(s);throw new Error('Dynamic require of "'+s+'" is not supported')};var F=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Ye=(s,e)=>{for(var r in e)O(s,r,{get:e[r],enumerable:!0})},Xe=(s,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of qe(e))!ze.call(s,n)&&n!=="default"&&O(s,n,{get:()=>e[n],enumerable:!(r=Ve(e,n))||r.enumerable});return s},d=s=>Xe(Qe(O(s!=null?_e($e(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var ee=F((V,Z)=>{(function(s,e){typeof V=="object"?Z.exports=e():typeof define=="function"&&define.amd?define(e):s.treeify=e()})(V,function(){function s(t,i){var a=i?"\u2514":"\u251C";return t?a+="\u2500 ":a+="\u2500\u2500\u2510",a}function e(t,i){var a=[];for(var u in t)!t.hasOwnProperty(u)||i&&typeof t[u]=="function"||a.push(u);return a}function r(t,i,a,u,o,c,p){var l="",k=0,h,w,b=u.slice(0);if(b.push([i,a])&&u.length>0&&(u.forEach(function(y,Ke){Ke>0&&(l+=(y[1]?" ":"\u2502")+"  "),!w&&y[0]===i&&(w=!0)}),l+=s(t,a)+t,o&&(typeof i!="object"||i instanceof Date)&&(l+=": "+i),w&&(l+=" (circular ref.)"),p(l)),!w&&typeof i=="object"){var A=e(i,c);A.forEach(function(y){h=++k===A.length,r(y,i[y],h,b,o,c,p)})}}var n={};return n.asLines=function(t,i,a,u){var o=typeof a!="function"?a:!1;r(".",t,!1,[],i,o,u||a)},n.asTree=function(t,i,a){var u="";return r(".",t,!1,[],i,a,function(o){u+=o+`
`}),u},n})});var ne=F((gr,oe)=>{oe.exports=function(){"use strict";function s(r,n){var t=n.length,i,a;return t>=2?(i=n.slice(0,t/2),a=n.slice(t/2,t),e(r,s(r,i),s(r,a))):n.slice()}function e(r,n,t){for(var i=[],a=n.length,u=t.length;a>0&&u>0;)r(n[0],t[0])<=0?(i.push(n.shift()),a--):(i.push(t.shift()),u--);return a>0?i.push.apply(i,n):i.push.apply(i,t),i}return s}()});var ie=F((mr,se)=>{se.exports=function(){"use strict";function s(e,r,n){var t,i;for(t=0,i=r.length;t<i&&!(e(r[t],n)>0);t++);return t}return s}()});var de=F((kr,pe)=>{var ae,ce;ae=ne();ce=ie();pe.exports=function(){"use strict";var s;s={};function e(o){return function(){return o}}function r(o){o=o||{},this.config=o,this.config.childrenPropertyName=o.childrenPropertyName||"children",this.config.modelComparatorFn=o.modelComparatorFn}function n(o,c){return c.parent=o,o.children.push(c),c}function t(o,c){this.config=o,this.model=c,this.children=[]}r.prototype.parse=function(o){var c,p,l;if(!(o instanceof Object))throw new TypeError("Model must be of type object.");if(l=new t(this.config,o),o[this.config.childrenPropertyName]instanceof Array)for(this.config.modelComparatorFn&&(o[this.config.childrenPropertyName]=ae(this.config.modelComparatorFn,o[this.config.childrenPropertyName])),c=0,p=o[this.config.childrenPropertyName].length;c<p;c++)n(l,this.parse(o[this.config.childrenPropertyName][c]));return l};function i(o){return typeof o.config.modelComparatorFn=="function"}t.prototype.isRoot=function(){return this.parent===void 0},t.prototype.hasChildren=function(){return this.children.length>0};function a(o,c,p){var l;if(!(c instanceof t))throw new TypeError("Child must be of type Node.");if(c.parent=o,o.model[o.config.childrenPropertyName]instanceof Array||(o.model[o.config.childrenPropertyName]=[]),i(o))l=ce(o.config.modelComparatorFn,o.model[o.config.childrenPropertyName],c.model),o.model[o.config.childrenPropertyName].splice(l,0,c.model),o.children.splice(l,0,c);else if(p===void 0)o.model[o.config.childrenPropertyName].push(c.model),o.children.push(c);else{if(p<0||p>o.children.length)throw new Error("Invalid index.");o.model[o.config.childrenPropertyName].splice(p,0,c.model),o.children.splice(p,0,c)}return c}t.prototype.addChild=function(o){return a(this,o)},t.prototype.addChildAtIndex=function(o,c){if(i(this))throw new Error("Cannot add child at index when using a comparator function.");return a(this,o,c)},t.prototype.setIndex=function(o){if(i(this))throw new Error("Cannot set node index when using a comparator function.");if(this.isRoot()){if(o===0)return this;throw new Error("Invalid index.")}if(o<0||o>=this.parent.children.length)throw new Error("Invalid index.");var c=this.parent.children.indexOf(this);return this.parent.children.splice(o,0,this.parent.children.splice(c,1)[0]),this.parent.model[this.parent.config.childrenPropertyName].splice(o,0,this.parent.model[this.parent.config.childrenPropertyName].splice(c,1)[0]),this},t.prototype.getPath=function(){var o=[];return function c(p){o.unshift(p),p.isRoot()||c(p.parent)}(this),o},t.prototype.getIndex=function(){return this.isRoot()?0:this.parent.children.indexOf(this)};function u(){var o={};if(arguments.length===1?typeof arguments[0]=="function"?o.fn=arguments[0]:o.options=arguments[0]:arguments.length===2?typeof arguments[0]=="function"?(o.fn=arguments[0],o.ctx=arguments[1]):(o.options=arguments[0],o.fn=arguments[1]):(o.options=arguments[0],o.fn=arguments[1],o.ctx=arguments[2]),o.options=o.options||{},o.options.strategy||(o.options.strategy="pre"),!s[o.options.strategy])throw new Error("Unknown tree walk strategy. Valid strategies are 'pre' [default], 'post' and 'breadth'.");return o}return t.prototype.walk=function(){var o;o=u.apply(this,arguments),s[o.options.strategy].call(this,o.fn,o.ctx)},s.pre=function o(c,p){var l,k,h;for(h=c.call(p,this),l=0,k=this.children.length;l<k;l++){if(h===!1)return!1;h=o.call(this.children[l],c,p)}return h},s.post=function o(c,p){var l,k,h;for(l=0,k=this.children.length;l<k;l++)if(h=o.call(this.children[l],c,p),h===!1)return!1;return h=c.call(p,this),h},s.breadth=function(c,p){var l=[this];(function k(){var h,w,b;if(l.length!==0){for(b=l.shift(),h=0,w=b.children.length;h<w;h++)l.push(b.children[h]);c.call(p,b)!==!1&&k()}})()},t.prototype.all=function(){var o,c=[];return o=u.apply(this,arguments),o.fn=o.fn||e(!0),s[o.options.strategy].call(this,function(p){o.fn.call(o.ctx,p)&&c.push(p)},o.ctx),c},t.prototype.first=function(){var o,c;return o=u.apply(this,arguments),o.fn=o.fn||e(!0),s[o.options.strategy].call(this,function(p){if(o.fn.call(o.ctx,p))return c=p,!1},o.ctx),c},t.prototype.drop=function(){var o;return this.isRoot()||(o=this.parent.children.indexOf(this),this.parent.children.splice(o,1),this.parent.model[this.config.childrenPropertyName].splice(o,1),this.parent=void 0,delete this.parent),this},r}()});var nr={};Ye(nr,{default:()=>or});var R=d(f("@yarnpkg/core"));var g;(function(n){n.baseRef="base-ref",n.prevRef="prev-ref",n.none="none"})(g||(g={}));var fe=d(f("@yarnpkg/core")),he=d(f("@yarnpkg/cli")),J=d(f("clipanion")),ge=d(f("@yarnpkg/core")),me=d(ee()),ke=d(f("typanion"));var C;(function(r){r.json="json",r.tree="tree"})(C||(C={}));var q=class{constructor(){this.children=[]}get chain(){return this._chain}get depth(){return this._chain.size}addChildren(e){return this.children.push(e),this}hasChildren(e){return this.children.some(r=>r.id===e.id)}hasDeepChildren(e){return e.children.some(r=>r.id===e.id||r.hasDeepChildren(e))}generateChain(){var e;this._chain=new Set((e=this.parent)==null?void 0:e.chain),this._chain.add(this.id)}};var D=class extends q{constructor(e,r){super();this.parent=r,this.workspace=e,this.generateChain()}get id(){return this.workspace.anchoredLocator}get name(){return this.workspace.manifest.raw.name}};function $(s){let e=[];return s.children.forEach(r=>{e.push($(r))}),{name:s.name,children:e}}function re(s){var r;let e=((r=s.children)==null?void 0:r.length)>0?{}:null;return s.children.forEach(n=>{e[n.name]=re(n)}),e}function te(s){return{[s.name]:re(s)}}var S=class{async resolve(e){return await e.restoreInstallState(),this.buildWorkspacesTree(e)}buildWorkspacesTree(e){let r=this.getEssentialWorkspaces(e);if(r.length===0)throw new Error("Project doesn't have any essentail workspaces");let n=new D(e.topLevelWorkspace);return r.forEach(t=>{let i=new D(t,n);this.fillChildrenNodes(e,i),n.addChildren(i)}),n}getWorkspacePackage(e,r){let n=e.storedPackages.get(r.anchoredLocator.locatorHash);if(!n)throw new Error("Unknown workspace");return n}getEssentialWorkspaces(e){return e.workspaces.filter(r=>r.locator.name===e.topLevelWorkspace.locator.name?!1:this.getWorkspaceInternalDependencies(e,r).size===0)}getWorkspaceInternalDependencies(e,r){let n=this.getWorkspacePackage(e,r),t=new Set;return[...n.dependencies,...n.peerDependencies].forEach(([,i])=>{let a=e.tryWorkspaceByIdent(i);a&&t.add(a)}),t}getWorkspaceExternalDependencies(e,r){let n=e.workspaces.filter(t=>{let i=this.getWorkspacePackage(e,t);return i.dependencies.has(r.locator.identHash)||i.peerDependencies.has(r.locator.identHash)});return new Set(n)}fillChildrenNodes(e,r){this.getWorkspaceExternalDependencies(e,r.workspace).forEach(t=>{if(r.chain.has(t.anchoredLocator))return;let i=new D(t,r);r.addChildren(i),this.fillChildrenNodes(e,i)})}};var le=d(de()),ue=le.default;var z=class{constructor(e){this.root=e,this.tree=this.parseWorkspaceNode(e)}findAllParents(e){return this.tree.all(({model:r})=>e.chain.has(r.id)||r.hasChildren(e)).map(r=>r.model)}findNodesByIds(e){return this.tree.all(({model:r})=>e.has(r.id)).map(r=>r.model)}findNodesByWorkspaces(e){return this.tree.all(({model:r})=>e.includes(r.workspace)).map(r=>r.model)}parseWorkspaceNode(e){return new ue().parse(e)}};var E=class extends he.BaseCommand{constructor(){super(...arguments);this.outputFormat=J.Option.String("-o,--output-format",C.tree,{description:"Output format, can be 'json', 'tree'",validator:(0,ke.isEnum)(C)});this.workspaceResolver=new S}async execute(){let e=await ge.Configuration.find(this.context.cwd,this.context.plugins),{project:r}=await fe.Project.find(e,this.context.cwd),n=await this.workspaceResolver.resolve(r);this.printTree(n)}printTree(e){switch(this.outputFormat){case C.json:{console.log(JSON.stringify($(e)));break}case C.tree:{console.log((0,me.asTree)(te(e),!1,!0));break}}}};E.paths=[["workspaces","graph"]],E.usage=J.Command.Usage({category:"Workspace-related commands",description:"Prints monitored workspaces graph"});var Be=d(f("@yarnpkg/core")),v=d(f("clipanion")),Ie=d(f("@yarnpkg/cli")),Ge=d(f("@yarnpkg/core")),P=d(f("typanion"));var Me=d(f("clipanion"));var B=d(f("@yarnpkg/core"));async function Ze(s){let e={cwd:s,strict:!1},{stdout:r}=await B.execUtils.execvp("git",["describe","--tags","--abbrev=0"],e),n=r.trim();if(!n)return"";let{stdout:t}=await B.execUtils.execvp("git",["rev-list","-n","1",n],e);return t.trim()}async function er(s,e){let r=[];for(let n of e){let{code:t}=await B.execUtils.execvp("git",["merge-base",n,"HEAD"],{cwd:s,strict:!1});t===0&&r.push(n)}return r}async function rr(s,e=[]){let r=await er(s,e);if(r.length===0)return"";let{stdout:n}=await B.execUtils.execvp("git",["merge-base","HEAD",...r],{cwd:s,strict:!1});return n.trim()}var ye=async s=>{let{projectCwd:e,baseRefs:r=[]}=s,n=await Ze(e);return{commit:n||await rr(e,r)}};var we=d(f("@yarnpkg/core")),be=async s=>{let{projectCwd:e}=s,r={cwd:e,strict:!1},{stdout:n}=await we.execUtils.execvp("git",["rev-parse","HEAD^1"],r);return{commit:n.trim()}};function ve(s){if(s===g.baseRef)return ye;if(s===g.prevRef)return be;throw new Error(`Unknown strategy ${s}`)}async function Pe(s,e){let{configuration:r}=s;return e||(e=r.get("changeDetectionStrategy")),(await ve(e)({projectCwd:r.projectCwd,baseRefs:r.get("changesetBaseRefs")})).commit}var Q=d(f("@yarnpkg/core"));function xe(s,e){let r=Q.miscUtils.mapAndFilter(e,n=>{let t=s.tryWorkspaceByFilePath(n);return t===null?Q.miscUtils.mapAndFilter.skip:t});return new Set(r)}var I=d(f("@yarnpkg/core")),G=d(f("@yarnpkg/fslib")),Ne=(s,e)=>e.split(/\r\n|\r|\n/).filter(r=>r.length>0).map(r=>G.ppath.resolve(s,G.npath.toPortablePath(r)));async function Ce(s,e){let r=s.configuration.projectCwd,n=s.configuration.get("changesetIgnorePatterns")||[],t={cwd:r,strict:!0},i=[];if(e){let{stdout:p}=await I.execUtils.execvp("git",["diff","--name-only",e],t);i=Ne(r,p)}let{stdout:a}=await I.execUtils.execvp("git",["ls-files","--others","--exclude-standard"],t),u=Ne(r,a),o=[...new Set([...i,...u].sort())],c=I.miscUtils.buildIgnorePattern(n);return c?o.filter(p=>!G.ppath.relative(s.cwd,p).match(c)):o}var H=d(f("@yarnpkg/fslib"));function Te(s,e){if(!e||e.length===0)return!1;let{workspace:r}=s;return e.some(n=>{let t=H.ppath.join(r.cwd,n);return H.xfs.existsSync(t)})}var T=class{constructor(){this.workspaceResolver=new S}async findCandidates(e,r={}){let{topLevelWorkspace:n,configuration:t}=e,{withAncestor:i,withPrivate:a}=r,{extra:u=[],ignoredAncestorsMarkers:o=[]}=r,c=await this.findAffectedWorkspaces(e,r.changeDetectionStrategy);a=a===void 0?t.get("detectPrivates"):a;let p=[...c].filter(y=>y===n?!1:!y.manifest.private||a),l=u.concat(t.get("extraWorkspaces"));if(l.length>0&&e.workspaces.forEach(y=>{l.includes(y.manifest.raw.name)&&!p.includes(y)&&p.push(y)}),p.length===0)return new Map;let k=await this.workspaceResolver.resolve(e),h=new z(k),w=this.findAffectedNodes(h,p);if(i=i===void 0?t.get("preserveAncestors"):i,!i)return w;let b=t.get("ignoredAncestorsMarkers")||[],A=this.mixAncestorsNodes(h,w,o.concat(b));return A.delete(k.workspace.locator),A}async findAffectedWorkspaces(e,r){if(e.configuration.projectCwd){if(r===g.none)return new Set(e.workspaces)}else throw new Me.UsageError("Invalid project configuration.");let n=await Pe(e,r),t=await Ce(e,n);return xe(e,t)}findAffectedNodes(e,r){let n=new Map;return e.findNodesByWorkspaces(r).forEach(t=>{let i=t.workspace.locator,a=n.get(i);(!a||a.depth<t.depth)&&n.set(i,t)}),n}mixAncestorsNodes(e,r,n=[]){let t=new Map;return r.forEach(i=>{e.findAllParents(i).forEach(a=>{(r.has(a.workspace.locator)||!Te(a,n))&&t.set(a.workspace.locator,a)})}),t}};function We(s,e){let r=Math.ceil(s.length/e),n=Array(r);for(let t=0;t<r;t++){let i=t*e;n[t]=s.slice(i,i+e)}return n}function W(s){let e=[];return s.forEach(r=>{e.push(r)}),e}function Re(s){let e=new Set;return s.forEach((r,n)=>{e.add(n)}),e}function Y(s){let e=new Map;return s.forEach((r,n)=>{let t=e.get(r)||[];t.push(n),e.set(r,t)}),e}var Ae=d(f("os")),K=()=>Math.max(1,(0,Ae.cpus)().length/2);function De(s,e){let r=[...Re(s)],n=0,t;return r.forEach(i=>{let a=s.get(i);i.hasChildren(e)&&(!t||i.depth>t.depth||a>n)&&(n=a,t=i)}),e.chain.forEach(i=>{let a=r.find(u=>u.id===i);a&&(!t||a.depth>t.depth)&&(t=a)}),t?[s.get(t),t]:[0,void 0]}function Se(s){return s.sort((e,r)=>{if(e.hasChildren(r))return-1;let n=e.depth===r.depth?"name":"depth";return e[n]>r[n]?1:-1})}var X=class{resolve(e){let r=new Map;return this.fillSourceFragment(r,Se(e)),r}fillSourceFragment(e,[r,...n]){if(!r)return;if(!r.parent)return e.set(r,0),this.fillSourceFragment(e,n);let[t,i]=De(e,r);i?e.set(r,t+1):e.set(r,0),n.length>0&&this.fillSourceFragment(e,n)}};var M=class{constructor(){this.rankResolver=new X}list(e){let r=[],n=this.rankResolver.resolve(e);return Y(n).forEach(t=>{r=r.concat(t)}),r}chunks(e){let{groupBy:r,input:n}=e,t=[],i=this.rankResolver.resolve(n);return Y(i).forEach(a=>{let u=We(a,r);t=t.concat(u)}),{groupBy:r,data:t}}};function Ee(s){return{groupBy:s.groupBy,data:s.data.map(e=>e.map(r=>r.name))}}var L=class extends Ie.BaseCommand{constructor(){super(...arguments);this.groupBy=v.Option.String("-g,--group-by",K().toString(),{description:"Slice workspaces by this number, it should be positive number",validator:(0,P.applyCascade)((0,P.isNumber)(),[(0,P.isAtLeast)(1)])});this.changeDetectionStrategy=v.Option.String("-s,--change-detection-strategy",{description:"Change detection strategy",validator:(0,P.isEnum)(g)});this.withAncestors=v.Option.Boolean("-a,--ancestors",!1,{description:"Perform operation over ancestors"});this.ignoredAncestorsMarkers=v.Option.Array("--ignored-ancestors-markers",[],{description:"The same as ignoredAncestorsMarkers"});this.withPrivate=v.Option.Boolean("--private",!0,{description:"Include private workspaces"});this.extraList=v.Option.Array("--extra",[],{description:"Add specific workspaces without change detection"});this.cdManager=new T;this.groupManager=new M}async execute(){let e=await Ge.Configuration.find(this.context.cwd,this.context.plugins),{project:r}=await Be.Project.find(e,this.context.cwd),n=await this.cdManager.findCandidates(r,{changeDetectionStrategy:this.changeDetectionStrategy,withAncestor:this.withAncestors,ignoredAncestorsMarkers:this.ignoredAncestorsMarkers,withPrivate:this.withPrivate,extra:this.extraList}),t=this.groupManager.chunks({groupBy:+this.groupBy,input:W(n)});console.log(JSON.stringify(Ee(t)))}};L.paths=[["workspaces","changed","chunks"]],L.usage=v.Command.Usage({category:"Workspace-related commands",description:"Prints affected workspaces collected by chunks"});var Le=d(f("@yarnpkg/core")),x=d(f("clipanion")),je=d(f("@yarnpkg/cli")),Ue=d(f("@yarnpkg/core")),Oe=d(f("typanion"));var j=class extends je.BaseCommand{constructor(){super(...arguments);this.changeDetectionStrategy=x.Option.String("-s,--change-detection-strategy",{description:"Change detection strategy",validator:(0,Oe.isEnum)(g)});this.withAncestors=x.Option.Boolean("-a,--ancestors",!1,{description:"Perform operation over ancestors"});this.ignoredAncestorsMarkers=x.Option.Array("--ignored-ancestors-markers",[],{description:"The same as ignoredAncestorsMarkers"});this.withPrivate=x.Option.Boolean("--private",!0,{description:"Include private workspaces"});this.extraList=x.Option.Array("--extra",[],{description:"Add specific workspaces without change detection"});this.cdManager=new T;this.groupManager=new M}async execute(){let e=await Ue.Configuration.find(this.context.cwd,this.context.plugins),{project:r}=await Le.Project.find(e,this.context.cwd),n=await this.cdManager.findCandidates(r,{changeDetectionStrategy:this.changeDetectionStrategy,withAncestor:this.withAncestors,ignoredAncestorsMarkers:this.ignoredAncestorsMarkers,withPrivate:this.withPrivate,extra:this.extraList}),t=this.groupManager.list(W(n)).map(i=>i.name);console.log(JSON.stringify(t))}};j.paths=[["workspaces","changed","list"]],j.usage=x.Command.Usage({category:"Workspace-related commands",description:"Prints workspaces that should be utilized."});var Fe=d(f("@yarnpkg/core")),m=d(f("clipanion")),Je=d(f("@yarnpkg/cli")),He=d(f("@yarnpkg/core")),N=d(f("typanion"));var _="@yarnpkg/plugin-workspace-tools";var U=class extends Je.BaseCommand{constructor(){super(...arguments);this.commandName=m.Option.String();this.args=m.Option.Proxy()||[];this.changeDetectionStrategy=m.Option.String("-s,--change-detection-strategy",{description:"Change detection strategy",validator:(0,N.isEnum)(g)});this.withAncestors=m.Option.Boolean("-a,--ancestors",!1,{description:"Perform operation over ancestors"});this.ignoredAncestorsMarkers=m.Option.Array("--ignored-ancestors-markers",[],{description:"The same as ignoredAncestorsMarkers"});this.withPrivate=m.Option.Boolean("--private",!0,{description:"Include private workspaces"});this.isParallel=m.Option.Boolean("-p,--parallel",!1,{description:"Run the commands in parallel"});this.groupBy=m.Option.String("-g,--group-by",K().toString(),{description:"Slice workspaces by this number, it should be positive number",validator:(0,N.applyCascade)((0,N.isNumber)(),[(0,N.isAtLeast)(1)])});this.excludeList=m.Option.Array("--exclude",[],{description:"Exclude specific workspaces"});this.includeList=m.Option.Array("--include",[],{description:"Include specific workspaces"});this.extraList=m.Option.Array("--extra",[],{description:"Add specific workspaces without change detection"});this.cdManager=new T;this.groupManager=new M}async execute(){let e=await He.Configuration.find(this.context.cwd,this.context.plugins),{project:r}=await Fe.Project.find(e,this.context.cwd);this.validate(e);let n=await this.getGroups(r);if(n.data.length===0){console.dir("No affected workspaces.");return}await this.executeGroups(n)}async getGroups(e){let r=await this.cdManager.findCandidates(e,{changeDetectionStrategy:this.changeDetectionStrategy,withAncestor:this.withAncestors,ignoredAncestorsMarkers:this.ignoredAncestorsMarkers,withPrivate:this.withPrivate,extra:this.extraList}),n=W(r).filter(t=>!(this.excludeList.includes(t.name)||this.includeList.length>0&&!this.includeList.includes(t.name)));return this.groupManager.chunks({groupBy:+this.groupBy,input:n})}async executeGroups(e){let r=["workspaces","foreach","-i","--topological-dev"];this.isParallel&&r.push("--parallel");for await(let n of e.data){let t=n.map(a=>a.name),i=t.reduce((a,u)=>[...a,"--include",u],[]);console.dir(`Execute '${this.args.join(" ")}' command over ${t.join(", ")}`),await this.cli.run([...r,...i,this.commandName,...this.args])}}validate(e){if(!e.plugins.has(_))throw new m.UsageError(`You should install ${_} plugin to use this command.`)}};U.paths=[["workspaces","changed","foreach"]],U.usage=m.Command.Usage({category:"Workspace-related commands",description:`A wrapper over foreach with -it options helping to invoke operations for changed workspaces. Required to have installed ${_} plugin.`});var tr={configuration:{changeDetectionStrategy:{description:"Which source the plugin should use in order to determine workspaces changes.",type:R.SettingsType.STRING,isNullable:!1,default:g.baseRef,values:[g.baseRef,g.prevRef]},detectPrivates:{description:"Gather private workspaces into changed list.",type:R.SettingsType.BOOLEAN,isNullable:!1,default:!0},ignoredAncestorsMarkers:{description:"If ancestor workspace contains these files/directories it will be excluded from execution list.",type:R.SettingsType.STRING,isNullable:!1,isArray:!0,default:[]},preserveAncestors:{description:"Preserve ancestors of changed workspaces.",type:R.SettingsType.BOOLEAN,isNullable:!1,default:!1},extraWorkspaces:{description:"List of additional workspaces outside change detection gathering.",type:R.SettingsType.STRING,isNullable:!1,isArray:!0,default:[]}},commands:[E,L,j,U]},or=tr;return nr;})();
return plugin;
}
};
